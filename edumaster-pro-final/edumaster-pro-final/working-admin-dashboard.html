<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - EduMaster Pro</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #2563eb;
            --primary-dark: #1e40af;
            --secondary: #10b981;
            --accent: #f59e0b;
            --danger: #ef4444;
            --dark: #0f172a;
            --dark-light: #1e293b;
            --gray: #64748b;
            --light-gray: #e2e8f0;
            --white: #ffffff;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            color: var(--white);
            min-height: 100vh;
        }

        .container {
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            width: 280px;
            background: rgba(30, 41, 59, 0.8);
            backdrop-filter: blur(10px);
            border-right: 1px solid rgba(255, 255, 255, 0.1);
            padding: 2rem 0;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
        }

        .logo {
            padding: 0 2rem 2rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .logo h1 {
            font-size: 1.5rem;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .nav-menu {
            padding: 2rem 0;
        }

        .nav-section {
            margin-bottom: 1.5rem;
        }

        .nav-section-title {
            padding: 0 2rem;
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--gray);
            text-transform: uppercase;
            margin-bottom: 0.5rem;
        }

        .nav-item {
            padding: 0.75rem 2rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .nav-item:hover {
            background: rgba(37, 99, 235, 0.1);
            border-left: 3px solid var(--primary);
        }

        .nav-item.active {
            background: rgba(37, 99, 235, 0.2);
            border-left: 3px solid var(--primary);
        }

        /* Main Content */
        .main-content {
            flex: 1;
            margin-left: 280px;
        }

        .topbar {
            background: rgba(30, 41, 59, 0.8);
            backdrop-filter: blur(10px);
            padding: 1.5rem 2rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .search-bar {
            display: flex;
            align-items: center;
            background: rgba(15, 23, 42, 0.6);
            border-radius: 0.5rem;
            padding: 0.5rem 1rem;
            gap: 0.5rem;
            min-width: 300px;
        }

        .search-bar input {
            background: none;
            border: none;
            color: var(--white);
            outline: none;
            width: 100%;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
        }

        .content-area {
            padding: 2rem;
        }

        .page-header {
            margin-bottom: 2rem;
        }

        .page-title {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .page-subtitle {
            color: var(--gray);
        }

        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: rgba(30, 41, 59, 0.6);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 1rem;
            padding: 1.5rem;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            border-color: var(--primary);
            box-shadow: 0 10px 30px rgba(37, 99, 235, 0.2);
        }

        .stat-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 1rem;
        }

        .stat-icon {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }

        .stat-icon.blue {
            background: rgba(37, 99, 235, 0.2);
        }

        .stat-icon.green {
            background: rgba(16, 185, 129, 0.2);
        }

        .stat-icon.orange {
            background: rgba(245, 158, 11, 0.2);
        }

        .stat-icon.red {
            background: rgba(239, 68, 68, 0.2);
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.25rem;
        }

        .stat-label {
            color: var(--gray);
            font-size: 0.9rem;
        }

        /* Sections */
        .section {
            background: rgba(30, 41, 59, 0.6);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 1rem;
            padding: 2rem;
            margin-bottom: 2rem;
            display: none;
        }

        .section.active {
            display: block;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .section-title {
            font-size: 1.5rem;
            font-weight: 600;
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            border: none;
            font-family: 'Poppins', sans-serif;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(37, 99, 235, 0.3);
        }

        .btn-success {
            background: var(--secondary);
            color: white;
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-small {
            padding: 0.5rem 1rem;
            font-size: 0.85rem;
        }

        /* Table */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }

        .data-table thead {
            background: rgba(15, 23, 42, 0.6);
        }

        .data-table th {
            text-align: left;
            padding: 1rem;
            font-weight: 600;
            color: var(--gray);
            text-transform: uppercase;
            font-size: 0.85rem;
        }

        .data-table td {
            padding: 1rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .data-table tbody tr {
            transition: all 0.3s ease;
        }

        .data-table tbody tr:hover {
            background: rgba(255, 255, 255, 0.03);
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--dark-light);
            border-radius: 1rem;
            padding: 2rem;
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: 700;
        }

        .close-btn {
            width: 32px;
            height: 32px;
            border: none;
            background: rgba(255, 255, 255, 0.1);
            color: var(--white);
            border-radius: 0.5rem;
            cursor: pointer;
            font-size: 1.25rem;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }

        .form-input, .form-select {
            width: 100%;
            padding: 0.75rem 1rem;
            background: rgba(15, 23, 42, 0.6);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 0.5rem;
            color: var(--white);
            font-family: 'Poppins', sans-serif;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 50px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .badge-success {
            background: rgba(16, 185, 129, 0.2);
            color: var(--secondary);
        }

        .badge-warning {
            background: rgba(245, 158, 11, 0.2);
            color: var(--accent);
        }

        .badge-danger {
            background: rgba(239, 68, 68, 0.2);
            color: var(--danger);
        }

        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 2rem;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(255, 255, 255, 0.1);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .alert {
            padding: 1rem;
            border-radius: 0.5rem;
            margin-bottom: 1rem;
            display: none;
        }

        .alert.show {
            display: block;
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .alert-success {
            background: rgba(16, 185, 129, 0.2);
            border: 1px solid var(--secondary);
            color: var(--secondary);
        }

        .alert-error {
            background: rgba(239, 68, 68, 0.2);
            border: 1px solid var(--danger);
            color: var(--danger);
        }

        .empty-state {
            text-align: center;
            padding: 3rem;
            color: var(--gray);
        }

        .empty-state-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="logo">
                <h1>EduMaster Pro</h1>
                <p style="color: var(--gray); font-size: 0.85rem;">Admin Portal</p>
            </div>

            <nav class="nav-menu">
                <div class="nav-section">
                    <div class="nav-section-title">Main</div>
                    <div class="nav-item active" onclick="showSection('dashboard')">
                        <span>üìä</span>
                        <span>Dashboard</span>
                    </div>
                </div>

                <div class="nav-section">
                    <div class="nav-section-title">Academic</div>
                    <div class="nav-item" onclick="showSection('students')">
                        <span>üë®‚Äçüéì</span>
                        <span>Students</span>
                    </div>
                    <div class="nav-item" onclick="showSection('teachers')">
                        <span>üë®‚Äçüè´</span>
                        <span>Teachers</span>
                    </div>
                    <div class="nav-item" onclick="showSection('classes')">
                        <span>üè´</span>
                        <span>Classes</span>
                    </div>
                    <div class="nav-item" onclick="showSection('attendance')">
                        <span>‚úì</span>
                        <span>Attendance</span>
                    </div>
                </div>

                <div class="nav-section">
                    <div class="nav-section-title">Financial</div>
                    <div class="nav-item" onclick="showSection('fees')">
                        <span>üí∞</span>
                        <span>Fee Management</span>
                    </div>
                </div>

                <div class="nav-section">
                    <div class="nav-section-title">System</div>
                    <div class="nav-item" onclick="window.location.href='session-management.html'">
                        <span>üìÖ</span>
                        <span>Sessions</span>
                    </div>
                    <div class="nav-item" onclick="window.location.href='role-management.html'">
                        <span>üîê</span>
                        <span>Roles</span>
                    </div>
                    <div class="nav-item" onclick="logout()">
                        <span>üö™</span>
                        <span>Logout</span>
                    </div>
                </div>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <div class="topbar">
                <div class="search-bar">
                    <span>üîç</span>
                    <input type="text" placeholder="Search anything..." id="globalSearch">
                </div>

                <div class="user-info">
                    <span id="userName">Admin User</span>
                    <div class="user-avatar" id="userAvatar">A</div>
                </div>
            </div>

            <div class="content-area">
                <!-- Dashboard Section -->
                <div class="section active" id="dashboardSection">
                    <div class="page-header">
                        <h1 class="page-title">Dashboard</h1>
                        <p class="page-subtitle">Welcome back! Here's your school overview</p>
                    </div>

                    <div id="alertContainer"></div>

                    <div class="stats-grid" id="statsGrid">
                        <div class="stat-card" onclick="showSection('students')">
                            <div class="stat-header">
                                <div>
                                    <div class="stat-value" id="totalStudents">0</div>
                                    <div class="stat-label">Total Students</div>
                                </div>
                                <div class="stat-icon blue">üë®‚Äçüéì</div>
                            </div>
                        </div>

                        <div class="stat-card" onclick="showSection('teachers')">
                            <div class="stat-header">
                                <div>
                                    <div class="stat-value" id="totalTeachers">0</div>
                                    <div class="stat-label">Total Teachers</div>
                                </div>
                                <div class="stat-icon green">üë®‚Äçüè´</div>
                            </div>
                        </div>

                        <div class="stat-card" onclick="showSection('classes')">
                            <div class="stat-header">
                                <div>
                                    <div class="stat-value" id="totalClasses">0</div>
                                    <div class="stat-label">Total Classes</div>
                                </div>
                                <div class="stat-icon orange">üè´</div>
                            </div>
                        </div>

                        <div class="stat-card" onclick="showSection('fees')">
                            <div class="stat-header">
                                <div>
                                    <div class="stat-value" id="feeCollected">‚Çπ0</div>
                                    <div class="stat-label">Fee Collected</div>
                                </div>
                                <div class="stat-icon green">üí∞</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Students Section -->
                <div class="section" id="studentsSection">
                    <div class="section-header">
                        <h2 class="section-title">Students Management</h2>
                        <button class="btn btn-primary" onclick="openAddStudentModal()">
                            + Add Student
                        </button>
                    </div>

                    <div id="studentsTable">
                        <div class="loading">
                            <div class="spinner"></div>
                        </div>
                    </div>
                </div>

                <!-- Teachers Section -->
                <div class="section" id="teachersSection">
                    <div class="section-header">
                        <h2 class="section-title">Teachers Management</h2>
                        <button class="btn btn-primary" onclick="openAddTeacherModal()">
                            + Add Teacher
                        </button>
                    </div>

                    <div id="teachersTable">
                        <div class="loading">
                            <div class="spinner"></div>
                        </div>
                    </div>
                </div>

                <!-- Classes Section -->
                <div class="section" id="classesSection">
                    <div class="section-header">
                        <h2 class="section-title">Classes Management</h2>
                        <button class="btn btn-primary" onclick="openAddClassModal()">
                            + Add Class
                        </button>
                    </div>

                    <div id="classesTable">
                        <div class="loading">
                            <div class="spinner"></div>
                        </div>
                    </div>
                </div>

                <!-- Attendance Section -->
                <div class="section" id="attendanceSection">
                    <div class="section-header">
                        <h2 class="section-title">Attendance Management</h2>
                        <button class="btn btn-primary" onclick="openMarkAttendanceModal()">
                            Mark Attendance
                        </button>
                    </div>

                    <div id="attendanceTable">
                        <div class="loading">
                            <div class="spinner"></div>
                        </div>
                    </div>
                </div>

                <!-- Fees Section -->
                <div class="section" id="feesSection">
                    <div class="section-header">
                        <h2 class="section-title">Fee Management</h2>
                        <button class="btn btn-primary" onclick="openAddFeeModal()">
                            + Add Fee Record
                        </button>
                    </div>

                    <div id="feesTable">
                        <div class="loading">
                            <div class="spinner"></div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Add Student Modal -->
    <div class="modal" id="addStudentModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Add New Student</h2>
                <button class="close-btn" onclick="closeModal('addStudentModal')">√ó</button>
            </div>

            <form id="addStudentForm" onsubmit="addStudent(event)">
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">First Name *</label>
                        <input type="text" class="form-input" name="firstName" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Last Name *</label>
                        <input type="text" class="form-input" name="lastName" required>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Date of Birth</label>
                        <input type="date" class="form-input" name="dateOfBirth">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Gender</label>
                        <select class="form-select" name="gender">
                            <option value="male">Male</option>
                            <option value="female">Female</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Email</label>
                        <input type="email" class="form-input" name="email">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Phone</label>
                        <input type="tel" class="form-input" name="phone">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Current Class</label>
                        <input type="text" class="form-input" name="currentClass" placeholder="e.g., Class 10">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Section</label>
                        <input type="text" class="form-input" name="currentSection" placeholder="e.g., A">
                    </div>
                </div>

                <button type="submit" class="btn btn-primary" style="width: 100%;">
                    Add Student
                </button>
            </form>
        </div>
    </div>

    <!-- Add Teacher Modal -->
    <div class="modal" id="addTeacherModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Add New Teacher</h2>
                <button class="close-btn" onclick="closeModal('addTeacherModal')">√ó</button>
            </div>

            <form id="addTeacherForm" onsubmit="addTeacher(event)">
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">First Name *</label>
                        <input type="text" class="form-input" name="firstName" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Last Name *</label>
                        <input type="text" class="form-input" name="lastName" required>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">Email *</label>
                    <input type="email" class="form-input" name="email" required>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Phone</label>
                        <input type="tel" class="form-input" name="phone">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Gender</label>
                        <select class="form-select" name="gender">
                            <option value="male">Male</option>
                            <option value="female">Female</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Designation</label>
                        <input type="text" class="form-input" name="designation" placeholder="e.g., Senior Teacher">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Department</label>
                        <input type="text" class="form-input" name="department" placeholder="e.g., Mathematics">
                    </div>
                </div>

                <button type="submit" class="btn btn-primary" style="width: 100%;">
                    Add Teacher
                </button>
            </form>
        </div>
    </div>

    <!-- Add Fee Modal -->
    <div class="modal" id="addFeeModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Add Fee Record</h2>
                <button class="close-btn" onclick="closeModal('addFeeModal')">√ó</button>
            </div>

            <form id="addFeeForm" onsubmit="addFee(event)">
                <div class="form-group">
                    <label class="form-label">Student *</label>
                    <select class="form-select" name="studentId" id="feeStudentSelect" required>
                        <option value="">Select Student</option>
                    </select>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Fee Type *</label>
                        <select class="form-select" name="feeType" required>
                            <option value="tuition">Tuition Fee</option>
                            <option value="admission">Admission Fee</option>
                            <option value="transport">Transport Fee</option>
                            <option value="library">Library Fee</option>
                            <option value="exam">Exam Fee</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Amount *</label>
                        <input type="number" class="form-input" name="amount" required min="0" step="0.01">
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">Due Date</label>
                    <input type="date" class="form-input" name="dueDate">
                </div>

                <button type="submit" class="btn btn-primary" style="width: 100%;">
                    Add Fee Record
                </button>
            </form>
        </div>
    </div>

    <script>
        // Configuration
        const API_URL = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1'
            ? 'http://localhost:10000/api'
            : '/api';

        const token = localStorage.getItem('authToken');

        // Check authentication
        if (!token) {
            window.location.href = 'login.html';
        }

        // API Helper Functions
        async function apiCall(endpoint, options = {}) {
            try {
                const defaultOptions = {
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    }
                };

                const response = await fetch(`${API_URL}${endpoint}`, {
                    ...defaultOptions,
                    ...options,
                    headers: {
                        ...defaultOptions.headers,
                        ...options.headers
                    }
                });

                if (response.status === 401) {
                    localStorage.removeItem('authToken');
                    window.location.href = 'login.html';
                    return null;
                }

                const data = await response.json();

                if (!response.ok) {
                    throw new Error(data.error || 'Request failed');
                }

                return data;
            } catch (error) {
                console.error('API Error:', error);
                showAlert(error.message || 'An error occurred', 'error');
                return null;
            }
        }

        // Alert Functions
        function showAlert(message, type = 'success') {
            const container = document.getElementById('alertContainer');
            const alert = document.createElement('div');
            alert.className = `alert alert-${type} show`;
            alert.textContent = message;
            container.appendChild(alert);

            setTimeout(() => {
                alert.classList.remove('show');
                setTimeout(() => alert.remove(), 300);
            }, 5000);
        }

        // Section Navigation
        function showSection(sectionName) {
            // Update nav items
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            event?.target.closest('.nav-item')?.classList.add('active');

            // Update sections
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });

            const section = document.getElementById(sectionName + 'Section');
            if (section) {
                section.classList.add('active');
                
                // Load data for the section
                switch(sectionName) {
                    case 'dashboard':
                        loadDashboardStats();
                        break;
                    case 'students':
                        loadStudents();
                        break;
                    case 'teachers':
                        loadTeachers();
                        break;
                    case 'classes':
                        loadClasses();
                        break;
                    case 'attendance':
                        loadAttendance();
                        break;
                    case 'fees':
                        loadFees();
                        break;
                }
            }
        }

        // Modal Functions
        function openAddStudentModal() {
            document.getElementById('addStudentModal').classList.add('active');
        }

        function openAddTeacherModal() {
            document.getElementById('addTeacherModal').classList.add('active');
        }

        function openAddFeeModal() {
            loadStudentsForSelect();
            document.getElementById('addFeeModal').classList.add('active');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        // Dashboard Stats
        async function loadDashboardStats() {
            const data = await apiCall('/dashboard/stats');
            if (data) {
                document.getElementById('totalStudents').textContent = data.totalStudents || 0;
                document.getElementById('totalTeachers').textContent = data.totalTeachers || 0;
                document.getElementById('totalClasses').textContent = data.totalClasses || 0;
                document.getElementById('feeCollected').textContent = `‚Çπ${(data.feeCollected || 0).toLocaleString()}`;
            }
        }

        // Students Functions
        async function loadStudents() {
            const container = document.getElementById('studentsTable');
            container.innerHTML = '<div class="loading"><div class="spinner"></div></div>';

            const students = await apiCall('/students');
            
            if (!students || students.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üë®‚Äçüéì</div>
                        <h3>No Students Found</h3>
                        <p>Start by adding your first student</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = `
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Student ID</th>
                            <th>Name</th>
                            <th>Class</th>
                            <th>Email</th>
                            <th>Phone</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${students.map(student => `
                            <tr>
                                <td>${student.studentId || 'N/A'}</td>
                                <td>${student.firstName} ${student.lastName}</td>
                                <td>${student.currentClass || 'Not Assigned'} ${student.currentSection || ''}</td>
                                <td>${student.email || 'N/A'}</td>
                                <td>${student.phone || 'N/A'}</td>
                                <td><span class="badge badge-success">${student.status || 'active'}</span></td>
                                <td>
                                    <button class="btn btn-small btn-primary" onclick="editStudent('${student.id}')">Edit</button>
                                    <button class="btn btn-small btn-danger" onclick="deleteStudent('${student.id}')">Delete</button>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
        }

        async function addStudent(event) {
            event.preventDefault();
            const formData = new FormData(event.target);
            const data = Object.fromEntries(formData);

            const result = await apiCall('/students', {
                method: 'POST',
                body: JSON.stringify(data)
            });

            if (result) {
                showAlert('Student added successfully!', 'success');
                closeModal('addStudentModal');
                event.target.reset();
                loadStudents();
                loadDashboardStats();
            }
        }

        async function deleteStudent(id) {
            if (!confirm('Are you sure you want to delete this student?')) return;

            const result = await apiCall(`/students/${id}`, {
                method: 'DELETE'
            });

            if (result) {
                showAlert('Student deleted successfully!', 'success');
                loadStudents();
                loadDashboardStats();
            }
        }

        // Teachers Functions
        async function loadTeachers() {
            const container = document.getElementById('teachersTable');
            container.innerHTML = '<div class="loading"><div class="spinner"></div></div>';

            const teachers = await apiCall('/teachers');
            
            if (!teachers || teachers.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üë®‚Äçüè´</div>
                        <h3>No Teachers Found</h3>
                        <p>Start by adding your first teacher</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = `
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Employee ID</th>
                            <th>Name</th>
                            <th>Email</th>
                            <th>Department</th>
                            <th>Designation</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${teachers.map(teacher => `
                            <tr>
                                <td>${teacher.employeeId || 'N/A'}</td>
                                <td>${teacher.firstName} ${teacher.lastName}</td>
                                <td>${teacher.email}</td>
                                <td>${teacher.department || 'N/A'}</td>
                                <td>${teacher.designation || 'N/A'}</td>
                                <td><span class="badge badge-success">${teacher.status || 'active'}</span></td>
                                <td>
                                    <button class="btn btn-small btn-primary" onclick="editTeacher('${teacher.id}')">Edit</button>
                                    <button class="btn btn-small btn-danger" onclick="deleteTeacher('${teacher.id}')">Delete</button>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
        }

        async function addTeacher(event) {
            event.preventDefault();
            const formData = new FormData(event.target);
            const data = Object.fromEntries(formData);

            const result = await apiCall('/teachers', {
                method: 'POST',
                body: JSON.stringify(data)
            });

            if (result) {
                showAlert('Teacher added successfully!', 'success');
                closeModal('addTeacherModal');
                event.target.reset();
                loadTeachers();
                loadDashboardStats();
            }
        }

        async function deleteTeacher(id) {
            if (!confirm('Are you sure you want to delete this teacher?')) return;

            const result = await apiCall(`/teachers/${id}`, {
                method: 'DELETE'
            });

            if (result) {
                showAlert('Teacher deleted successfully!', 'success');
                loadTeachers();
                loadDashboardStats();
            }
        }

        // Fees Functions
        async function loadFees() {
            const container = document.getElementById('feesTable');
            container.innerHTML = '<div class="loading"><div class="spinner"></div></div>';

            const fees = await apiCall('/fees');
            
            if (!fees || fees.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üí∞</div>
                        <h3>No Fee Records Found</h3>
                        <p>Start by adding fee records</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = `
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Student</th>
                            <th>Fee Type</th>
                            <th>Amount</th>
                            <th>Paid Amount</th>
                            <th>Due Date</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${fees.map(fee => `
                            <tr>
                                <td>${fee.Student ? `${fee.Student.firstName} ${fee.Student.lastName}` : 'N/A'}</td>
                                <td>${fee.feeType}</td>
                                <td>‚Çπ${parseFloat(fee.amount || 0).toLocaleString()}</td>
                                <td>‚Çπ${parseFloat(fee.paidAmount || 0).toLocaleString()}</td>
                                <td>${fee.dueDate ? new Date(fee.dueDate).toLocaleDateString() : 'N/A'}</td>
                                <td><span class="badge badge-${fee.status === 'paid' ? 'success' : fee.status === 'pending' ? 'warning' : 'danger'}">${fee.status}</span></td>
                                <td>
                                    <button class="btn btn-small btn-success" onclick="payFee('${fee.id}')">Pay</button>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
        }

        async function loadStudentsForSelect() {
            const students = await apiCall('/students?status=active');
            const select = document.getElementById('feeStudentSelect');
            
            if (students && students.length > 0) {
                select.innerHTML = '<option value="">Select Student</option>' +
                    students.map(s => `<option value="${s.id}">${s.firstName} ${s.lastName} (${s.studentId})</option>`).join('');
            }
        }

        async function addFee(event) {
            event.preventDefault();
            const formData = new FormData(event.target);
            const data = Object.fromEntries(formData);

            const result = await apiCall('/fees', {
                method: 'POST',
                body: JSON.stringify(data)
            });

            if (result) {
                showAlert('Fee record added successfully!', 'success');
                closeModal('addFeeModal');
                event.target.reset();
                loadFees();
                loadDashboardStats();
            }
        }

        async function payFee(feeId) {
            const amount = prompt('Enter payment amount:');
            if (!amount || isNaN(amount)) return;

            const result = await apiCall(`/fees/${feeId}/pay`, {
                method: 'PUT',
                body: JSON.stringify({
                    amount: parseFloat(amount),
                    paymentMethod: 'cash'
                })
            });

            if (result) {
                showAlert('Payment recorded successfully!', 'success');
                loadFees();
                loadDashboardStats();
            }
        }

        // Classes placeholder
        function loadClasses() {
            document.getElementById('classesTable').innerHTML = `
                <div class="empty-state">
                    <div class="empty-state-icon">üè´</div>
                    <h3>Classes Management</h3>
                    <p>Coming soon...</p>
                </div>
            `;
        }

        // Attendance placeholder
        function loadAttendance() {
            document.getElementById('attendanceTable').innerHTML = `
                <div class="empty-state">
                    <div class="empty-state-icon">‚úì</div>
                    <h3>Attendance Management</h3>
                    <p>Coming soon...</p>
                </div>
            `;
        }

        // Logout
        function logout() {
            if (confirm('Are you sure you want to logout?')) {
                localStorage.removeItem('authToken');
                window.location.href = 'login.html';
            }
        }

        // Initialize
        window.onload = function() {
            const userData = JSON.parse(localStorage.getItem('userData') || '{}');
            if (userData.firstName) {
                document.getElementById('userName').textContent = userData.firstName;
                document.getElementById('userAvatar').textContent = userData.firstName.charAt(0).toUpperCase();
            }
            
            loadDashboardStats();
        };

        // Edit functions placeholders
        function editStudent(id) {
            showAlert('Edit functionality coming soon!', 'warning');
        }

        function editTeacher(id) {
            showAlert('Edit functionality coming soon!', 'warning');
        }
    </script>
</body>
</html>
